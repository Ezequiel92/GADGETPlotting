# 🌌 GADGET Plotting

[![ForTheBadge built-with-science](http://forthebadge.com/images/badges/built-with-science.svg)](https://GitHub.com/Ezequiel92/) 

[![ForTheBadge made-with-julia](https://forthebadge.com/images/badges/made-with-julia.svg)](https://julialang.org)

[![GitHub](https://img.shields.io/github/license/Ezequiel92/GADGETPlotting?style=flat-square)](https://github.com/Ezequiel92/GADGETPlotting/blob/main/LICENSE) [![Maintenance](https://img.shields.io/maintenance/yes/2021?style=flat-square)](mailto:lozano.ez@gmail.com)

Julia module for creating plots, GIFs, and videos from the data produced by GAGET2/3/4 simulations.

- It only works with the traditional output format (binary data) which is the default in GADGET2/3 (`SnapFormat = 1`) and a compatibility option in GADGET4 (`SnapFormat = 1`).
- It is a script inside a module, not a package. Only five global constants and no data structures are defined.
- A small testing data set is provided in `example/test_data/`.
- The script `example/run_examples.jl` shows how to import the main module, gives examples for every function, and provides a sanity check, as it should run as is without throwing any errors.
- The dependencies are given by the `Manifest.toml` and `Project.toml` files.

## 🖥️ Functions

There are four tiers of functions:

- Auxiliary functions (`src/auxiliary.jl`): These are only for internal use. All but `makeVideo` are pure functions that do soma data processing.
- Data acquisition functions (`src/data_acquisition.jl`): These are only for internal use. They take the location of the data files, apply some transformation (e.g. unit conversions) and return the data inside a familiar data structure.
- Plotting functions (`src/plotting.jl`): These are exported, but I do not recommend using them as is. If you insist in using them, read the section `Plotting backends warning` below. These are pure functions that take data in the format outputted by the data acquisition functions and return plot objects. They do all the data processing necessary to produce the plots, except the unit conversions. They will plot using the units selected when the data acquisition functions were called.
- Pipeline functions (`src/pipelines.jl`): These are exported. These functions run a whole pipeline, from raw data to the final plot. They take the location of the snapshot files with some configuration parameters, and as a result, produce a series of plots/GIFs/videos. By default, some of these functions may generate a large number of images (but it can be configured to do less), and they may take a long time to run, especially if the function uses the `pgfplotsx` backend of [Plots.jl](https://github.com/JuliaPlots/Plots.jl).

## 🚨 Plotting backends

The plotting functions make use of different backends which are activated within each function. So, to save the figures after a plotting function call, you have to use `Base.invokelatest(savefig, figure, location)` instead of `savefig(figure, location)` (as it is done in `example/example_plotting.jl`). The pipeline functions do this internally, so you can call them directly with no extra caveats. 

## 📜 Documentation

Each function is documented within the corresponding source file where a docstring explains the functionality, the arguments, and the returns.

Refer to `example/` for how to use the functions. Note that the scripts there expect the simple file structure of this repo, namely:

    .
    ├── src
    │    ├── GADGETPlotting.jl 
    │    └── ...
    ├── example   
    │    ├── test_data
    │    │    └── ...
    │    ├── run_examples.jl
    │    └── ...
    └── ...
    
More examples can be found in the repository [plotting_scripts](https://github.com/Ezequiel92/plotting_scripts).

## 🔗 References

[GADGET2](https://wwwmpa.mpa-garching.mpg.de/gadget/)

[GADGET4](https://wwwmpa.mpa-garching.mpg.de/gadget4/)

## ⚠️ Warnings

- Some functions are intended for the data generated by GADGET3, which is not a publicly available code. See for example the documentation for the `sfrTxtData` function.
- This script is written for personal use and may break at any moment. So, no guarantees are given.
